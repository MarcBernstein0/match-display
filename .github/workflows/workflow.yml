# Workflow name
name: Match-Display-Deploy

# Run workflow on every push to main branch
on: 
  push: 
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
# Workflow jobs
jobs:

  deploy:
    name: Deploy to Heroku
    runs-on: ubuntu-latest
    steps:
    
    # Clone the repo
    - name: Checkout
      uses: actions/checkout@v2

    # Build Docker Image
    - name: Docker Build and Deploy
      run: docker login --username=_ --password=$HEROKU_API_KEY registry.heroku.com

    # PUSH the Docker image to Heroku Container Reistry
    - name: Publish
      env:
        WORKDIR: "."
        DOCKERFILE_NAME: "./container/Dockerfile"
        DOCKER_OPTIONS: "--no-cache"
        APP_NAME: ${{ 'match-display' }}
        USER_NAME: ${{ secrets.CHALLONGE_USERNAME }}
        API_KEY: ${{ secrets.CHALLONGE_API_KEY }}
        GIN_RELEASE: $${{ secrets.RELEASE }}
      run: |
        docker build --file ${DOCKERFILE_NAME} \
          ${DOCKER_OPTIONS} \
          --tag registry.heroku.com/${APP_NAME}/web .
        heroku container:push web -a $APP_NAME
        heroku container:release web -a $APP_NAME
# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       # Check-out your repo
#       - name: Checkout
#         uses: actions/checkout@v2

#       - name: Login to Heroku Container registry
#         env:
#           HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
#         run: heroku container:login
#       - name: Build and push container
#         env:
#           HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
#         run: heroku container:push -a ${{ secrets.HEROKU_APP_NAME }} web
# jobs:
#   Explore-GitHub-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
#       - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#       - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#       - name: Check out repository code
#         uses: actions/checkout@v3
#       - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
#       - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
#       - name: List files in the repository
#         run: |
#           ls ${{ github.workspace }}
#       - run: echo "üçè This job's status is ${{ job.status }}."
